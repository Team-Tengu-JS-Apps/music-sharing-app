{"version":3,"sources":["../../../../public/scripts/controllers/users-controller.js"],"names":["usersController","all","context","users","get","then","resUsers","template","$element","html","register","$","bootstrapValidator","live","trigger","on","event","preventDefault","data","isValid","toastr","warning","user","username","val","password","resp","success","Promise","resolve","reject","setTimeout","error","responseJSON","res","redirect","document","location","reload","signOut","signIn","err"],"mappings":"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","file":"users-controller.js","sourcesContent":["import {dataService} from 'data';\r\nimport {templateLoader} from 'templates';\r\n\r\nconst usersController = function () {\r\n\r\n    function all(context) {\r\n        let users;\r\n\r\n        dataService.users.get()\r\n            .then(function (resUsers) {\r\n                users = resUsers;\r\n                return templateLoader.get('users');\r\n            })\r\n            .then(function (template) {\r\n                context.$element().html(template(users));\r\n            });\r\n    }\r\n\r\n    function register(context) {\r\n        templateLoader.get('register')\r\n            .then(function (template) {\r\n                context.$element().html(template());\r\n\r\n                $('#register-user-form')\r\n                    .bootstrapValidator({\r\n                        live: 'enabled',\r\n                        trigger: null\r\n                    });\r\n\r\n                $('#btn-register').on('click', function (event) {\r\n                    event.preventDefault();\r\n\r\n                    const bootstrapValidator = $(\"#register-user-form\").data('bootstrapValidator');\r\n\r\n                    if (!bootstrapValidator.isValid()) {\r\n                        toastr.warning(`Unable to register user!`);\r\n                        return;\r\n                    }\r\n\r\n                    const user = {\r\n                        username: $('#tb-reg-username').val(),\r\n                        password: $('#tb-reg-pass').val()\r\n                    };\r\n\r\n                    dataService.users.register(user)\r\n                        .then(function (resp) {\r\n                            toastr.success('Registered successfully');\r\n                            return new Promise(function (resolve, reject) {\r\n                                setTimeout(function () {\r\n                                    resolve(resp);\r\n                                }, 500);\r\n                            });\r\n                        }, function (resp) {\r\n                            toastr.error(resp.responseJSON);\r\n                            return Promise.reject();\r\n                        })\r\n                        .then(function (res) {\r\n                            context.redirect('#/');\r\n                            document.location.reload(true);\r\n                        });\r\n                });\r\n            });\r\n    }\r\n\r\n    function signOut() {\r\n        dataService.users.signOut()\r\n            .then(function () {\r\n                document.location = '#/';\r\n                document.location.reload(true);\r\n            });\r\n    }\r\n\r\n    function signIn() {\r\n        const user = {\r\n            username: $('#tb-username').val(),\r\n            password: $('#tb-password').val()\r\n        };\r\n\r\n        dataService.users.signIn(user)\r\n            .then(function (user) {\r\n                document.location = '#/';\r\n                document.location.reload(true);\r\n            }, function (err) {\r\n                $('#container-sign-in').trigger(\"reset\");\r\n                toastr.error(err.responseJSON);\r\n            });\r\n    }\r\n\r\n    return {\r\n        all,\r\n        register,\r\n        signOut,\r\n        signIn\r\n    };\r\n}();\r\n\r\nexport {usersController};"]}