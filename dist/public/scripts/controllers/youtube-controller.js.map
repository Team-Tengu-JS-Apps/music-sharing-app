{"version":3,"sources":["../../../../public/scripts/controllers/youtube-controller.js"],"names":["youTubeController","query","context","songUrl","$","val","songId","parseIdFromYoutubeURL","get","then","template","$element","find","html","ytData","resp","Promise","resolve","reject","setTimeout","status","evaluateUnderdogStatus","underdogStatus","isValid","stat","song","title","url","description","underdog","songs","add","toastr","success","redirect","catch","err","error","responseJSON","hide"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEA,IAAMA,oBAAoB,YAAY;;AAElC,aAASC,KAAT,CAAeC,OAAf,EAAwB;AACpB,YAAIC,UAAUC,EAAE,cAAF,EAAkBC,GAAlB,EAAd;AACA,YAAMC,SAAS,qCAAkBC,qBAAlB,CAAwCJ,OAAxC,CAAf;;AAEA,kCAAeK,GAAf,CAAmB,eAAnB,EACKC,IADL,CACU,UAAUC,QAAV,EAAoB;AACtBR,oBAAQS,QAAR,GAAmBC,IAAnB,CAAwB,yBAAxB,EAAmDC,IAAnD,CAAwDH,UAAxD;AACH,SAHL,EAIKD,IAJL,CAIU,YAAY;AACd,mBAAO,kBAAYK,MAAZ,CAAmBb,KAAnB,CAAyBK,MAAzB,CAAP;AACH,SANL,EAOKG,IAPL,CAOU,UAAUM,IAAV,EAAgB;AAClB,mBAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC;AACAC,2BAAW;AAAA,2BAAKF,QAAQF,IAAR,CAAL;AAAA,iBAAX,EAA+B,IAA/B;AACH,aAHM,CAAP;AAIH,SAZL,EAaKN,IAbL,CAaU,UAAUM,IAAV,EAAgB;AAClB,mBAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC1C,oBAAME,SAAS,qCAAkBC,sBAAlB,CAAyCN,IAAzC,EAA+CO,cAA9D;AACA,oBAAMC,UAAU,CAAC,CAACH,MAAlB;AACA,uBAAOG,UAAUN,QAAQG,MAAR,CAAV,GAA4BF,qDAAnC;AACH,aAJM,CAAP;AAKH,SAnBL,EAoBKT,IApBL,CAoBU,UAAUe,IAAV,EAAgB;AAClB,gBAAMC,OAAO;AACTC,uBAAOtB,EAAE,gBAAF,EAAoBC,GAApB,EADE;AAETsB,qBAAKvB,EAAE,cAAF,EAAkBC,GAAlB,EAFI;AAGTuB,6BAAaxB,EAAE,sBAAF,EAA0BC,GAA1B,EAHJ;AAITwB,0BAAUL;AAJD,aAAb;;AAOA,8BAAYM,KAAZ,CAAkBC,GAAlB,CAAsBN,IAAtB,EACKhB,IADL,CACU,UAAUM,IAAV,EAAgB;AAClBiB,uBAAOC,OAAP,YAAwBR,KAAKC,KAA7B,iCAA8DF,IAA9D;AACAtB,wBAAQgC,QAAR,CAAiB,SAAjB;AACH,aAJL;AAKH,SAjCL,EAkCKC,KAlCL,CAkCW,UAAUC,GAAV,EAAe;AAClBJ,mBAAOK,KAAP,CAAc,OAAOD,GAAP,KAAe,QAAhB,GAA4BA,GAA5B,GAAkCA,IAAIE,YAAnD;AACAlC,cAAE,gBAAF,EAAoBmC,IAApB;AACH,SArCL;AAsCH;;AAED,WAAO;AACHtC;AADG,KAAP;AAGH,CAjDyB,EAA1B;;QAmDQD,iB,GAAAA,iB","file":"youtube-controller.js","sourcesContent":["import {dataService} from 'data';\r\nimport {templateLoader} from 'templates';\r\nimport {controllerHelpers} from 'controller-helpers';\r\n\r\nconst youTubeController = function () {\r\n\r\n    function query(context) {\r\n        let songUrl = $('#tb-song-url').val();\r\n        const songId = controllerHelpers.parseIdFromYoutubeURL(songUrl);\r\n\r\n        templateLoader.get('youtube-query')\r\n            .then(function (template) {\r\n                context.$element().find('#content-underdog-query').html(template());\r\n            })\r\n            .then(function () {\r\n                return dataService.ytData.query(songId);\r\n            })\r\n            .then(function (resp) {\r\n                return new Promise((resolve, reject) => {\r\n                    // ux-driven delay :) so we can have a look at the progress bar\r\n                    setTimeout(x => resolve(resp), 1000);\r\n                });\r\n            })\r\n            .then(function (resp) {\r\n                return new Promise(function (resolve, reject) {\r\n                    const status = controllerHelpers.evaluateUnderdogStatus(resp).underdogStatus;\r\n                    const isValid = !!status;\r\n                    return isValid ? resolve(status) : reject(`This song doesn't qualify as an \"Underdog\"`);\r\n                });\r\n            })\r\n            .then(function (stat) {\r\n                const song = {\r\n                    title: $('#tb-song-title').val(),\r\n                    url: $('#tb-song-url').val(),\r\n                    description: $('#tb-song-description').val(),\r\n                    underdog: stat\r\n                };\r\n\r\n                dataService.songs.add(song)\r\n                    .then(function (resp) {\r\n                        toastr.success(`Song \"${song.title}\" added. Underdog status ${stat}!`);\r\n                        context.redirect('#/songs');\r\n                    });\r\n            })\r\n            .catch(function (err) {\r\n                toastr.error((typeof err === 'string') ? err : err.responseJSON);\r\n                $(\"#song-yt-query\").hide();\r\n            });\r\n    }\r\n\r\n    return {\r\n        query\r\n    };\r\n}();\r\n\r\nexport {youTubeController};\r\n"]}